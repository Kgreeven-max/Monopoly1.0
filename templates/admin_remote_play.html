<!-- Remote Play Administration Tab -->
<div class="tab-pane fade" id="remote-play" role="tabpanel" aria-labelledby="remote-play-tab">
    <div class="container-fluid">
        <!-- Status Alerts -->
        <div id="alert-container" class="mt-3"></div>
        <div id="loading-message" class="alert alert-info" style="display: none;">Loading...</div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">Remote Play Status</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <strong>Remote Play:</strong> <span id="remote-enabled">Unknown</span>
                                </div>
                                <div class="mb-3">
                                    <strong>Cloudflared:</strong> <span id="cloudflared-installed">Unknown</span>
                                </div>
                                <div class="mb-3">
                                    <strong>Tunnel Status:</strong> <span id="tunnel-status">Unknown</span>
                                </div>
                                <div class="mb-3">
                                    <strong>Tunnel URL:</strong> <span id="tunnel-url">Unknown</span>
                                </div>
                                <div class="mb-3">
                                    <label for="timeout-input" class="form-label">Reconnect Timeout (seconds):</label>
                                    <div class="input-group">
                                        <input type="number" id="timeout-input" class="form-control" min="10" max="300" value="60">
                                        <button class="btn btn-secondary" id="save-timeout-btn">Save</button>
                                    </div>
                                    <div class="form-text">How long to wait for disconnected players to reconnect (10-300 seconds)</div>
                                </div>
                            </div>
                            <div class="col-md-6" id="connection-info" style="display: none;">
                                <div class="text-center mb-3">
                                    <h5>Connection QR Code</h5>
                                    <img id="qr-code" src="" alt="Connection QR Code" class="img-thumbnail" style="max-width: 200px;">
                                </div>
                                <div class="text-center">
                                    <a href="/connect" target="_blank" class="btn btn-outline-primary">View Connection Page</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="row">
                            <div class="col-md-6 mb-2">
                                <div class="input-group">
                                    <input type="text" id="tunnel-name-input" class="form-control" placeholder="Tunnel Name" value="pinopoly">
                                    <button class="btn btn-success" id="create-tunnel-btn">Create Tunnel</button>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <button class="btn btn-primary me-2" id="start-tunnel-btn">Start Tunnel</button>
                                <button class="btn btn-warning me-2" id="stop-tunnel-btn">Stop Tunnel</button>
                                <button class="btn btn-danger" id="delete-tunnel-btn">Delete Tunnel</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">Connected Players (<span id="connected-count">0</span>)</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>Player</th>
                                        <th>Status</th>
                                        <th>Last Connect</th>
                                        <th>Last Disconnect</th>
                                        <th>Disconnected For</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="players-table-body">
                                    <tr>
                                        <td colspan="6" class="text-center">No players connected</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-footer">
                        <button class="btn btn-info" onclick="RemotePlayAdmin.refreshPlayers()">Refresh Player List</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">Remote Play Instructions</h5>
                    </div>
                    <div class="card-body">
                        <ol>
                            <li><strong>First Time Setup:</strong> Create a tunnel using the "Create Tunnel" button.</li>
                            <li><strong>Start the Tunnel:</strong> Click "Start Tunnel" to activate remote play.</li>
                            <li><strong>Share Connection:</strong> Share the tunnel URL or QR code with players.</li>
                            <li><strong>Monitor Players:</strong> Keep track of connected players in the table above.</li>
                            <li><strong>Troubleshoot:</strong> Use the ping feature to check connection quality.</li>
                            <li><strong>Timeout:</strong> Adjust the reconnect timeout based on your players' connection quality.</li>
                        </ol>
                        <div class="alert alert-info">
                            <strong>Note:</strong> Players must have their PINs to connect remotely. The connection page at
                            <a href="/connect" target="_blank">/connect</a> provides easy sharing options.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- CSS for Remote Play Tab -->
<style>
    /* Status indicators */
    .status-success {
        color: #28a745;
        font-weight: bold;
    }
    .status-warning {
        color: #ffc107;
        font-weight: bold;
    }
    .status-error {
        color: #dc3545;
        font-weight: bold;
    }
    .pinging {
        color: #17a2b8;
        font-weight: bold;
        font-style: italic;
    }
    
    /* Buttons */
    #remote-play .btn {
        white-space: nowrap;
    }
    
    /* Table responsiveness */
    @media (max-width: 768px) {
        #remote-play .table-responsive {
            font-size: 0.85rem;
        }
        #remote-play .btn-sm {
            padding: 0.2rem 0.4rem;
            font-size: 0.75rem;
        }
    }
</style>

<!-- Initialize Remote Play Admin when tab is selected -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize when tab is shown
    const remotePlayTab = document.getElementById('remote-play-tab');
    if (remotePlayTab) {
        remotePlayTab.addEventListener('shown.bs.tab', function() {
            if (window.adminKey) {
                RemotePlayAdmin.init(window.adminKey);
                
                // Connect socket handlers if socket exists
                if (window.socket) {
                    RemotePlayAdmin.setupSocketHandlers(window.socket);
                }
            }
        });
    }
});
</script> 